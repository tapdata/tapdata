[
  {
    "createIndexes": "ApiMetricsRaw",
    "indexes": [
      {
        "key": {
          "apiId": -1,
          "processId": -1,
          "timeGranularity": -1,
          "timeStart": -1,
          "metricType": 1
        },
        "name": "ApiMetricsRaw_query-1",
        "background": true
      }
    ]
  },
  {
    "createIndexes": "ApiMetricsRaw",
    "indexes": [
      {
        "key": {
          "callId": -1
        },
        "name": "ApiMetricsRaw_query_last_one",
        "background": true
      }
    ]
  },
  {
    "createIndexes": "ApiMetricsRaw",
    "indexes": [{
      "key": {
        "timeStart": 1
      },
      "expireAfterSeconds": 2592000,
      "name": "ApiMetricsRaw_1_ttl",
      "background": true
    }]
  },
  {
    "createIndexes": "ServerUsage",
    "indexes": [{
      "key": {
        "createTime": 1
      },
      "expireAfterSeconds": 2592000,
      "name": "ServerUsage_1_ttl",
      "background": true
    }]
  },
  {
    "createIndexes": "ServerUsage",
    "indexes": [{
      "key": {
        "processId": 1,
        "workOid": 1,
        "lastUpdateTime": 1
      },
      "name": "ServerUsage_upsert_index",
      "background": true
    }]
  },
  {
    "createIndexes": "ServerUsageMetric",
    "indexes": [{
      "key": {
        "createTime": 1
      },
      "expireAfterSeconds": 2592000,
      "name": "ServerUsage_1_ttl",
      "background": true
    }]
  },
  {
    "createIndexes": "ServerUsageMetric",
    "indexes": [{
      "key": {
        "processId": 1,
        "workOid": 1,
        "lastUpdateTime": 1,
        "timeGranularity": 1
      },
      "name": "ServerUsage_upsert_index",
      "background": true
    }]
  },
  {
    "delete": "Settings_Alarm",
    "deletes": [
      {
        "q": {
          "key": "API_SERVER_WORKER_DELAY_P50_WARN"
        },
        "limit": 1
      },
      {
        "q": {
          "key": "API_SERVER_WORKER_DELAY_P95_WARN"
        },
        "limit": 1
      },
      {
        "q": {
          "key": "API_SERVER_WORKER_DELAY_P99_WARN"
        },
        "limit": 1
      },
      {
        "q": {
          "key": "API_SERVER_WORKER_ERROR_RATE_WARN"
        },
        "limit": 1
      },
      {
        "q": {
          "key": "API_SERVER_WORKER_ERROR_RATE_ALTER"
        },
        "limit": 1
      }
    ]
  },
  {
    "insert": "Settings_Alarm",
    "documents": [
      {
        "emailAlarmContent": "<div style=\"max-width: 600px; margin: 20px auto; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 32px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #374151; line-height: 1.6; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\" class=\"email-content-root\"><div style=\"text-align: center; margin-bottom: 16px;\" class=\"email-root-header\"><div style=\"display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: #fef2f2; border-radius: 50%; font-size: 24px;\" class=\"email-root-header-icon\"><p class=\"ace-line\" style=\"margin: 0; font-size: inherit;\">⚠\uFE0F</p></div></div><h1 style=\"font-size: 20px; font-weight: 600; color: #111827; text-align: center; margin: 0 0 8px 0;\"><strong>P95 requested for execution is too high</strong></h1><hr style=\"height: 1px; background: #f3f4f6; border: none; margin: 24px 0;\"><p class=\"ace-line\" style=\"font-size: 14px; margin: 16px 0 4px 0;\"><strong style=\"font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">API Server Name</strong></p><p class=\"ace-line\" style=\"margin: 8px 0; font-size: 14px; margin-top: 16px;\"><span data-variable=\"serverName\" variablename=\"serverName\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{serverName}</span></p><p class=\"ace-line\" style=\"font-size: 14px; margin: 16px 0 4px 0; margin-top: 16px;\"><strong style=\"font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">DETAIL</strong></p><p class=\"ace-line\" style=\"margin: 8px 0; font-size: 14px; margin-top: 16px;\">Request delay per minute P95<span data-variable=\"equalsFlag\" variablename=\"equalsFlag\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{equalsFlag}</span><span data-variable=\"threshold\" variablename=\"threshold\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{threshold}</span><span data-variable=\"unit\" variablename=\"unit\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{unit}</span>and it lasted for<span data-variable=\"minutes\" variablename=\"minutes\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{minutes}</span>minutes</p><p class=\"ace-line\" style=\"color: #9ca3af; font-size: 12px; line-height: 1.4; text-align: center; margin: 16px 0 0 0; margin-top: 16px;\"><em style=\"font-style: normal;\">This email is sent by TapData</em></p></div>",
        "emailAlarmTitle": "【TapData Notification: P95 requested for execution in the API service is too high】{serverName}",
        "interval": 300,
        "key": "API_SERVER_P95_WARN",
        "notify": ["SYSTEM", "EMAIL"],
        "open": true,
        "sort": 7,
        "type": "API_SERVER",
        "unit": "SECOND",
        "variables": [
          {
            "name": "serverName",
            "label": "public_api_server_name",
            "icon": "IconLucideFileText"
          },
          {
            "name": "threshold",
            "label": "public_api_threshold",
            "icon": "IconLucideFileText"
          },
          {
            "name": "unit",
            "label": "public_api_threshold_unit",
            "icon": "IconLucideFileText"
          },
          {
            "name": "equalsFlag",
            "label": "public_api_threshold_equalsFlag",
            "icon": "IconLucideFileText"
          },
          {
            "name": "minutes",
            "label": "public_api_minute",
            "icon": "IconLucideFileText"
          },
          {
            "name": "alarmDate",
            "label": "public_api_alarmDate",
            "icon": "IconLucideFileText"
          }
        ]
      },
      {
        "emailAlarmContent": "<div style=\"max-width: 600px; margin: 20px auto; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 32px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #374151; line-height: 1.6; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\" class=\"email-content-root\"><div style=\"text-align: center; margin-bottom: 16px;\" class=\"email-root-header\"><div style=\"display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: #fef2f2; border-radius: 50%; font-size: 24px;\" class=\"email-root-header-icon\"><p class=\"ace-line\" style=\"margin: 0; font-size: inherit;\">⚠\uFE0F</p></div></div><h1 style=\"font-size: 20px; font-weight: 600; color: #111827; text-align: center; margin: 0 0 8px 0;\"><strong>Error rate for execution is too high</strong></h1><hr style=\"height: 1px; background: #f3f4f6; border: none; margin: 24px 0;\"><div style=\"max-width: 600px; margin: 20px auto; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 32px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #374151; line-height: 1.6; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\" class=\"email-content-root\"><p class=\"ace-line\" style=\"font-size: 14px; margin: 16px 0 4px 0;\"><strong style=\"font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">API Server Name</strong></p><p class=\"ace-line\" style=\"margin: 8px 0; font-size: 14px; margin-top: 16px;\"><span data-variable=\"serverName\" variablename=\"serverName\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{serverName}</span></p><p class=\"ace-line\" style=\"font-size: 14px; margin: 16px 0 4px 0; margin-top: 16px;\"><strong style=\"font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">DETAIL</strong></p><p class=\"ace-line\" style=\"margin: 8px 0; font-size: 14px; margin-top: 16px;\">Request delay per minute P95<span data-variable=\"equalsFlag\" variablename=\"equalsFlag\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{equalsFlag}</span><span data-variable=\"threshold\" variablename=\"threshold\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{threshold}</span><span data-variable=\"unit\" variablename=\"unit\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{unit}</span>and it lasted for<span data-variable=\"minutes\" variablename=\"minutes\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{minutes}</span>minutes</p></div><hr style=\"height: 1px; background: #f3f4f6; border: none; margin: 24px 0;\"><p class=\"ace-line\" style=\"color: #9ca3af; font-size: 12px; line-height: 1.4; text-align: center; margin: 16px 0 0 0;\"><em style=\"font-style: normal;\">This email is sent by TapData</em></p></div>",
        "emailAlarmTitle": "【TapData Notification: P99 requested for execution in the API service is too high】{serverName}",
        "interval": 300,
        "key": "API_SERVER_P99_WARN",
        "notify": ["SYSTEM", "EMAIL"],
        "open": true,
        "sort": 7,
        "type": "API_SERVER",
        "unit": "SECOND",
        "variables": [
          {
            "name": "serverName",
            "label": "public_api_server_name",
            "icon": "IconLucideFileText"
          },
          {
            "name": "threshold",
            "label": "public_api_threshold",
            "icon": "IconLucideFileText"
          },
          {
            "name": "unit",
            "label": "public_api_threshold_unit",
            "icon": "IconLucideFileText"
          },
          {
            "name": "equalsFlag",
            "label": "public_api_threshold_equalsFlag",
            "icon": "IconLucideFileText"
          },
          {
            "name": "minutes",
            "label": "public_api_minute",
            "icon": "IconLucideFileText"
          },
          {
            "name": "alarmDate",
            "label": "public_api_alarmDate",
            "icon": "IconLucideFileText"
          }
        ]
      },
      {
        "_id": {"$oid": "68cbd78044efffdb602c7007"},
        "emailAlarmContent": "<div style=\"max-width: 600px; margin: 20px auto; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 32px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #374151; line-height: 1.6; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\" class=\"email-content-root\"><div style=\"text-align: center; margin-bottom: 16px;\" class=\"email-root-header\"><div style=\"display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: #fef2f2; border-radius: 50%; font-size: 24px;\" class=\"email-root-header-icon\"><p class=\"ace-line\" style=\"margin: 0; font-size: inherit;\">⚠\uFE0F</p></div></div><h1 style=\"font-size: 20px; font-weight: 600; color: #111827; text-align: center; margin: 0 0 8px 0;\"><strong>Error rate too high of server</strong></h1><hr style=\"height: 1px; background: #f3f4f6; border: none; margin: 24px 0;\"><div style=\"max-width: 600px; margin: 20px auto; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 32px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #374151; line-height: 1.6; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\" class=\"email-content-root\"><p class=\"ace-line\" style=\"font-size: 14px; margin: 16px 0 4px 0;\"><strong style=\"font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">API Server Name</strong></p><p class=\"ace-line\" style=\"margin: 8px 0; font-size: 14px; margin-top: 16px;\"><span data-variable=\"serverName\" variablename=\"serverName\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{serverName}</span></p><p class=\"ace-line\" style=\"font-size: 14px; margin: 16px 0 4px 0; margin-top: 16px;\"><strong style=\"font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">DETAIL</strong></p><p class=\"ace-line\" style=\"margin: 8px 0; font-size: 14px; margin-top: 16px;\">Error rate per minute<span data-variable=\"equalsFlag\" variablename=\"equalsFlag\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{equalsFlag}</span><span data-variable=\"threshold\" variablename=\"threshold\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{threshold}</span><span data-variable=\"unit\" variablename=\"unit\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{unit}</span>And it lasted for<span data-variable=\"minutes\" variablename=\"minutes\" data-system-variable=\"true\" class=\"system-variable\" contenteditable=\"false\">{minutes}</span>minutes</p></div><hr style=\"height: 1px; background: #f3f4f6; border: none; margin: 24px 0;\"><p class=\"ace-line\" style=\"color: #9ca3af; font-size: 12px; line-height: 1.4; text-align: center; margin: 16px 0 0 0;\"><em style=\"font-style: normal;\">This email is sent by TapData</em></p></div>",
        "emailAlarmTitle": "【TapData Notification: Error rate requested for execution in the API service is too high】{serverName}",
        "interval": 300,
        "key": "API_SERVER_ERROR_RATE_WARN",
        "notify": ["SYSTEM", "EMAIL"],
        "open": true,
        "sort": 7,
        "type": "API_SERVER",
        "unit": "SECOND",
        "variables": [
          {
            "name": "serverName",
            "label": "public_api_server_name",
            "icon": "IconLucideFileText"
          },
          {
            "name": "threshold",
            "label": "public_api_threshold",
            "icon": "IconLucideFileText"
          },
          {
            "name": "unit",
            "label": "public_api_threshold_unit",
            "icon": "IconLucideFileText"
          },
          {
            "name": "equalsFlag",
            "label": "public_api_threshold_equalsFlag",
            "icon": "IconLucideFileText"
          },
          {
            "name": "minutes",
            "label": "public_api_minute",
            "icon": "IconLucideFileText"
          },
          {
            "name": "alarmDate",
            "label": "public_api_alarmDate",
            "icon": "IconLucideFileText"
          }
        ]
      }
    ]
  },
  {
    "insert": "Settings_Alarm_Rule",
    "documents": [
      {
        "equalsFlag": 1,
        "key": "API_SERVER_P95_WARN",
        "ms": 1000,
        "point": 12,
        "times": 0,
        "unit": "ms",
        "value": 1000
      },
      {
        "equalsFlag": 1,
        "key": "API_SERVER_P99_WARN",
        "ms": 1000,
        "point": 12,
        "times": 0,
        "unit": "ms",
        "value": 1200
      },
      {
        "equalsFlag": 1,
        "key": "API_SERVER_ERROR_RATE_WARN",
        "ms": 1000,
        "point": 12,
        "times": 0,
        "unit": "%",
        "value": 50
      }
    ]
  }
]